services:
  seda-overlay:
    build:
      context: ../..
      dockerfile: .build/docker/Dockerfile
      args:
        # Default to bun-linux-x64 if not specified
        # NOTE: On mac devices you should export `bun-linux-arm64`
        BUN_TARGET_ARCH: ${TARGET_ARCH:-bun-linux-arm64}
    environment:
      # Network to connect to (e.g., mainnet, testnet, devnet)
      SEDA_NETWORK: ${SEDA_NETWORK:-testnet}
      # SEDA mnemonic (provide via .env file or environment)
      SEDA_MNEMONIC: ${SEDA_MNEMONIC}
      SEDA_CONFIG_PATH: "/root/.seda/testnet/config.jsonc"
    volumes:
      # Mount local .seda directory to store config generated by 'init'
      - type: bind
        source: ./.seda
        target: /root/.seda # seda-overlay expects config in ~/.seda
        consistency: cached
    # Override the default CMD to pass the network flag
    command: ["run", "--network", "${SEDA_NETWORK:-testnet}"]
    networks:
      - overlay-network

networks:
  overlay-network:
    driver: bridge
